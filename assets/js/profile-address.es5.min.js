"use strict";(function(n){function t(){this.ready()}return t.prototype={controller:"ProfileAddress",selector:"[data-controller='ProfileAddress']",vars:{id:0,sectorId:0,createNewMap:!0,cityId:0,sectorPartId:0,mapService:null,mapId:"addresse-map",isAddressChange:!1,oldAddress:"",currentAddress:""},ready:function(){var t=this;n.autoClick(t);n.autoChange(t);$(document).on(t.controller+".show.modal",function(){t.$elems={$id:$(t.selector+" #Id"),$sectorId:$(t.selector+" #SectorId"),$sectorPartId:$(t.selector+" #SectorPartId"),$cityId:$(t.selector+" #CityId"),$lat:$(t.selector+" #Lat"),$lng:$(t.selector+" #Lng"),$address:$(t.selector+" #Address"),$address2:$(t.selector+" #Address2"),$type:$(t.selector+" #Type"),$transferee:$(t.selector+" #Transferee"),$mobilePhone:$(t.selector+" #MobilePhone"),$isCheckout:$(t.selector+" #IsCheckout"),$unit:$(t.selector+" #Unit"),$plaque:$(t.selector+" #Plaque")};t.vars.id=+t.$elems.$id.val()||0;t.vars.sectorId=+t.$elems.$sectorId.val()||0;t.$elems.$address.on("input",function(){var n=+$("#location-tab.uk-tab li.uk-active").data("code")||0,t;n===1&&(t=$(this).val())});t.vars.mapService=new MapService;t.vars.id===0?t.currentLocation():(t.$elems.$cityId.trigger("change"),setTimeout(function(){var n=parseFloat(t.$elems.$cityId.find("option:selected").data("lat"))||0,i=parseFloat(t.$elems.$cityId.find("option:selected").data("lng"))||0;t.vars.mapService.createMapWithMarker(t.vars.mapId,t.$elems.$lat.val()||n,t.$elems.$lng.val()||i)},500));$(document).on("geocoder",function(n){t.vars.sectorId=0;t.$elems.$lat.val(n.location.lat);t.$elems.$lng.val(n.location.lng);$("#location-address").html(n.location.address)})});$(document).on("frmAddAddress.submit.done",function(){location.href.includes("order/sendorder")?(n.uiBusy(),location.reload()):t.fetchAddress()});$(document).on("frmAddAddress.submit.errorCode",function(i){switch(i.errorCode){case 20:n.notify.confirm(i.message,function(){var i={};i={lat:t.$elems.$lat.val(),lng:t.$elems.$lng.val(),type:1,addresse:{transferee:t.$elems.$transferee.val(),mobilePhone:t.$elems.$mobilePhone.val(),isCheckout:t.$elems.$isCheckout.val(),lat:t.$elems.$lat.val(),lng:t.$elems.$lng.val(),address:t.$elems.$address.val(),unit:t.$elems.$unit.val(),plaque:t.$elems.$plaque.val(),type:1}};$.post("/location/changeShoppingCartStore/",i).done(function(t){if(typeof t=="string"&&t.indexOf("err_connection_refused")>-1)return $(document).trigger("ajaxError");if(t.success)if(t.errorCode===22)n.notify.confirm(t.message,function(){n.uiBusy();location.href="/order/cart"},{labels:{Ok:"حتما بررسی میکنم"}});else return n.uiBusy(),location.reload();else return n.notify.danger(t.message)}).fail(function(t){t.status!==0&&n.notify.danger("خطا در ارتباط با سرور")})},{labels:{Ok:"بله",Cancel:"خیر"}})}})},saveAddress:function(n,t){t.preventDefault();$("#frmAddAddress").submit()},fetchAddress:function(){var t=this;n.loadPartialView("/profile/addresse",null,"#profile-wrapper",function(){$(t.selector+"input[name='SelectAddress']").filter("[value="+t.vars.id+"]").prop("checked",!0)})},showModalAddAddress:function(t,i){i.preventDefault();var r=this;n.showModalDialog("/profile/addAddresseModal/",r.controller)},showModalEditAddress:function(t,i){i.preventDefault();var r=this;return(r.vars.id=+$(t).data("id"),$("#box-option-"+r.vars.id).prop("checked",!0),r.vars.id===0)?okala.notify.danger("هیچ آدرسی انتخاب نشده است"):n.showModalDialog("/profile/addAddresseModal/"+r.vars.id,r.controller,function(){$(".modal-title").text("ویرایش آدرس")})},sectorPartChange:function(n){var t=this;t.vars.sectorId=$(n).find("option:selected").data("sectorId");t.$elems.$sectorId.val(t.vars.sectorId)},getSectorParts:function(){var n=this,t=n.$elems.$sectorPartId,i="/Location/GetCitySectorParts/"+n.vars.cityId;$('label[for="SectorPartId"]').html('محله <span class="text-danger">در حال بارگزاری...<\/span>');$.get(i,function(i,r){if(r==="success"){if(i.length===0)return;$(t).empty();$("<option />",{value:"",text:"لطفا یک محله را انتخاب کنید...","data-sector-id":0}).appendTo(t);$.each(i,function(n,i){$("<option />",{value:i.id,text:i.name,"data-sector-id":i.sectorId}).appendTo(t)});n.vars.id>0&&function(){var t=+n.$elems.$sectorPartId.data("sectorPartId"),r=i.filter(function(n){return n.id===t});r.length>0&&n.$elems.$sectorPartId.val(t).trigger("change")}();$('label[for="SectorPartId"]').html("محله")}})},cityChange:function(n){var t=this,i=$(n);t.vars.cityId=+i.val();t.getSectorParts()},selectAddress:function(n){var t=this;t.vars.id=$(n).val()},deleteAdddress:function(t,i){i.preventDefault();var r=this;return(r.vars.id=+$(t).data("id"),$("#box-option-"+r.vars.id).prop("checked",!0),r.vars.id===0)?okala.notify.danger("هیچ آدرسی انتخاب نشده است"):(n.deleteEntity("/profile/deleteAddresse/"+r.vars.id,null,function(){r.fetchAddress()}),0)},setDefaultAddress:function(t){var r=this,i=$(t).data("id");$("input[name='IsDefault']").not($(t)).prop("checked",!1);$.post("/profile/SetDefaultAddress/"+i).done(function(t){return typeof t=="string"&&t.indexOf("err_connection_refused")>-1?$(document).trigger("ajaxError"):t.success?0:n.notify.danger(t.message)}).fail(function(t){if(t.status!==0)return n.notify.danger("عملیات با شکست انجام شد")})},currentLocation:function(){var n=this;setTimeout(function(){n.vars.mapService.createMapWithCurrentLocation(n.vars.mapId);n.createNewMap=!1},1e3)}},new t})(okala);